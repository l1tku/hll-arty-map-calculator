/* Container for the stacked title */
.modal-brand-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px 20px; /* Reduced vertical padding to save space */
  gap: 4px; /* Space between title and credits */
}

/* The Main Project Name */
.main-title {
  font-family: 'GothamSS', sans-serif;
  font-weight: 900;
  font-size: 28px; /* Slightly smaller to fit credits comfortably */
  color: #ffc107;
  text-transform: uppercase;
  letter-spacing: 2px;
  text-shadow: 0 0 15px rgba(255, 193, 7, 0.4);
}

/* Your Credit Line */
.main-subtitle-credits {
  font-family: 'GothamSS', sans-serif;
  font-weight: 700;
  font-size: 10px; /* Reduced slightly to fit version number */
  color: rgba(255, 255, 255, 0.4); /* Subtle grey */
  letter-spacing: 2px; /* Adjusted for better legibility */
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 8px; /* Space between v1.0.0, year, and name */
  text-shadow: none; /* Explicitly remove any glow effects */
}

/* Mobile Adjustment to keep header compact */
@media (max-width: 768px) {
  .main-title {
    font-size: 18px;
    letter-spacing: 1px;
  }
  .main-subtitle-credits {
    font-size: 8px;
    letter-spacing: 1.5px;
  }
  .modal-brand-header {
    padding: 15px 10px;
  }
}

/* ==========================================
   GLOBAL SETTINGS
   ========================================== */
* {
  box-sizing: border-box;
}

:root {
  --bg: #1d1f27;
  --panel-border: rgba(255, 255, 255, 0.1);
  --grid-color: rgba(255, 255, 255, 1.0);
  --major-width: 2px; 
  --minor-width: 1px;
  color-scheme: dark; /* Force dark system controls */
}

/* --- Flag Styles --- */
.faction-flag {
  width: 28px;
  height: auto;
  margin-right: 8px;
  border-radius: 2px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.5);
  vertical-align: middle;
}

/* Ensure flex alignment in the dropdown items */
.dropdown-item {
  display: flex;
  align-items: center;
}

/* Ensure flex alignment in the main button */
#factionBtn {
  display: flex;
  align-items: center;
  justify-content: flex-start;
}

#factionBtn .icon {
  margin-left: auto;
}

@font-face {
  font-family: 'GothamSS';
  src: url('../fonts/Gotham.otf') format('opentype');
  font-weight: 900;
  font-style: normal;
}

/* Chrome/Blink rendering fixes */
.marker-label, 
.hll-grid-label,  
.data-value {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html {
    /* STOPS Pull-to-Refresh on Android */
    overscroll-behavior-y: none; 
    
    /* STOPS the whole page from bouncing on iOS */
    overflow: hidden; 
    
    /* STOPS double-tap to zoom on buttons */
    touch-action: none;

    /* Fixes the "Address Bar" jumping issue */
    height: 100dvh; 
}

body {
  margin: 0; height: 100dvh; width: 100vw;
  background: var(--bg);
  display: flex; align-items: center; justify-content: center;
  overflow: hidden; font-family: sans-serif;
  user-select: none;           
  -webkit-user-select: none;   
  -moz-user-select: none;      
  -ms-user-select: none;       
}

.shell {
  width: 100%; height: 100%; padding: 20px;
  box-sizing: border-box; display: flex; flex-direction: column;
}

/* ==========================================
   MAP CONTAINER & STAGE
   ========================================== */
.map-wrap {
  position: relative; width: 100%; height: 100%;
  background: #000;
  border: 1px solid var(--panel-border);
  border-radius: 4px; overflow: hidden; 

  /* --- CUSTOM CURSOR --- */
  /* 16 16 sets the "hotspot" (click point) to the center of a 32x32 image. */
  /* Change 'png' to 'webp' if your file is .webp */
  /* cursor: url('../images/ui/garrison_lining_dot_2.png') 16 16, auto; */
}

/* Ensure the cursor changes to a grabbing hand when you click/drag */
.map-wrap:active {
  cursor: grabbing;
}

.map-stage, 
.grid-layer, 
.label-layer {
  backface-visibility: hidden;
  perspective: 1000px;
}

.map-stage {
  transform-origin: 0 0; 
  position: absolute; 
  top: 0; 
  left: 0;
  
  /* CRITICAL FOR MOBILE PERFORMANCE */
  will-change: transform; 
  transform: translate3d(0, 0, 0); /* Forces GPU layer creation */
  backface-visibility: hidden;
  transition: opacity 0.4s ease-in-out;
}

.map-stage.zoom-transition {
  transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.map-image {
  display: block; 
  pointer-events: none; 
  max-width: none; 
  max-height: none;
  image-rendering: high-quality;
  transition: opacity 0.3s ease-in-out;
  background-color: black; /* Prevents white flashes */
}

/* ==========================================
   GRID SYSTEM
   ========================================== */
.grid-layer {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: 2;
}

.keypad-grid {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; opacity: 0;
  transition: opacity 0.2s ease-in-out;
  background-image:
    linear-gradient(to right, rgba(0,0,0,0.7) var(--minor-width), transparent var(--minor-width)),
    linear-gradient(to bottom, rgba(0,0,0,0.7) var(--minor-width), transparent var(--minor-width));
  
  shape-rendering: geometricPrecision;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.hll-grid-line {
  position: absolute; 
  background-color: var(--grid-color);
  box-shadow: none; 
  pointer-events: none; 
  z-index: 2;
  
  transform-origin: center;
  backface-visibility: hidden;
}

.hll-grid-line.vertical { top: 0; bottom: 0; width: var(--major-width); }
.hll-grid-line.horizontal { left: 0; right: 0; height: var(--major-width); }

/* ==========================================
   LABELS (Sticky Axis)
   ========================================== */
.label-layer {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: 10; overflow: hidden;
}

.hll-grid-label {
  position: absolute;
  top: 0; left: 0;
  font-family: 'GothamSS', sans-serif; font-weight: 900; font-size: 24px;
  color: #ffffff;
  text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000, 3px 3px 4px rgba(0,0,0,0.9);
  display: flex; align-items: center; justify-content: center;
  width: 0; height: 0; pointer-events: none; z-index: 3;
  transform-origin: center center;
  transition: none !important;
}

/* ==========================================
   MARKERS
   ========================================== */
.markers-layer {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none;
  z-index: 50; /* Much higher than marker-label */
  text-rendering: geometricPrecision;
  shape-rendering: geometricPrecision;
}

.marker {
  position: absolute;
  pointer-events: auto;
  display: flex; align-items: center; justify-content: center;
}

.marker.point {
  width: 32px; height: 32px; z-index: 10;
  display: flex; align-items: center; justify-content: center;
  background-color: transparent; border: none; border-radius: 0;
}

.arty-icon {
  width: 70%; height: 70%; display: block; pointer-events: none;
  
  /* Filters */
  filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 1px black);
  
  transition: transform 0.2s ease-out;
  
  /* FIX: Force GPU rendering context */
  transform: translateZ(0);
  
  /* FIX: Firefox-specific hack. Adding a transparent outline forces the browser
     to use a higher quality anti-aliasing method during rotation. */
  outline: 1px solid transparent;
  
  /* FIX: Ensure standard image interpolation */
  image-rendering: auto; 
  
  /* FIX: Prevent backface flickering */
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

.marker.dimmed-gun { opacity: 0.4; transition: opacity 0.2s ease; }

/* Ensure the active gun is above the trajectory line (100) */
.marker.active-gun { 
    z-index: 105 !important; 
}

/* Ensure the tiny X stays at the absolute top */
.impact-marker {
    z-index: 110 !important;
}

/* Keep the trajectory line and circles at 100 */
.trajectory-visual, 
.impact-circles-svg {
    z-index: 100 !important;
}

/* Ensure other guns stay below the line */
.marker.dimmed-gun {
    z-index: 10 !important;
}
.marker.active-gun .arty-icon {
  filter: invert(1) drop-shadow(0 0 2px rgba(0, 0, 0, 0.8)) drop-shadow(0 0 1px rgba(255, 255, 255, 0.5));
}

.marker.strongpoint { 
    background: none; border: none; border-radius: 0;
    display: flex; justify-content: center; align-items: center;
    position: absolute; overflow: visible;
    transform-origin: center center; box-sizing: border-box; 
    /* Lower than the line (was 25) */
    z-index: 10 !important; 
}

.marker.strongpoint .marker-visual {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    border-radius: 50%; box-sizing: border-box; 
    /* Draw outline INSIDE the circle (do not grow the circle outward) */
    border: none;
    background-color: transparent; 
    background-image: repeating-linear-gradient(-45deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.1) 16px, #000000 16px, #000000 18px);
    pointer-events: none; z-index: 1; 
    box-shadow:
      inset 0 0 0 8px #000000,
      0 0 4px rgba(0,0,0,0.5);
}

.marker-label {
  position: absolute; 
  top: 50%; left: 50%; 
  /* Lower than the line (was 20) */
  z-index: 15 !important; 
  font-size: 40px; font-family: 'GothamSS', sans-serif; font-weight: 700; color: white;
  padding: 2px 6px; background-color: rgba(20, 20, 20, 0.70); border-radius: 2px;
  text-align: center; white-space: nowrap; pointer-events: none;
  transform-origin: center center;
  backface-visibility: hidden; -webkit-font-smoothing: antialiased;
  will-change: transform, top;

  /* --- DELETED: transition: transform 0.2s, top 0.2s; --- */
  /* Removing this prevents the labels from "jumping" when you click shoot */
}

.marker-label::after {
    content: ''; 
    position: absolute; 
    top: 100%; 
    left: 50%; 
    transform: translateX(-50%);
    
    /* Your custom size (Keep this) */
    border-left: 20px solid transparent;   
    border-right: 20px solid transparent;  
    border-top: 20px solid rgba(20, 20, 20, 0.85); 
    
    opacity: var(--arrow-opacity, 0); 
    
    /* --- DELETE THIS LINE TO STOP FLICKER --- */
    /* transition: opacity 0.2s; */
}

/* --- CONTROLS DRAWER --- */
.controls-drawer {
  /* Position absolute at bottom to allow sliding off screen */
  position: relative; 
  /* CHANGE: Force full width to remove side gaps */
  width: 100%; 
  max-width: 100%; 
  
  /* Animation settings */
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateY(0); /* Default: Open */
  
  /* Flex to center the content */
  display: flex;
  flex-direction: column;
  align-items: center;
  pointer-events: none; /* Let clicks pass through invisible areas */
    /* CHANGE: High Z-Index to beat the HUD */
    z-index: 1000 !important; 
    
    background-color: rgba(0,0,0,0);
}

/* CLOSED STATE: Slide down 100% (flush with bottom) */
.controls-drawer.closed,
.controls-drawer.hidden-by-default {
  /* CHANGE: Removed " + 20px" so it tucks away perfectly */
  transform: translateY(100%);
}

/* ==========================================
   UNIFIED UI THEME (Exact Color Match Fix)
   ========================================== */

/* Define the exact shared background color here */
:root {
    --drawer-bg: #181818; 
}

/* LAYER 1: The Drawer Tab (Lowest) */
.drawer-tab {
    position: absolute;
    top: -31px !important;
    height: 32px;
    width: 80px;
    
    /* Z-INDEX 1200: Lower than the Panel */
    z-index: 1200 !important; 
    
    /* EXACT COLOR MATCH */
    background-color: var(--drawer-bg) !important;
    
    /* Borders */
    border-top: 1px solid rgba(255, 255, 255, 0.3);
    border-left: 1px solid rgba(255, 255, 255, 0.3);
    border-right: 1px solid rgba(255, 255, 255, 0.3);
    border-bottom: none !important;
    
    /* Shape */
    border-radius: 10px 10px 0 0 !important;
    cursor: pointer;
    pointer-events: auto;
    display: flex; align-items: center; justify-content: center;
    
    /* REMOVE SHADOWS to flatten the look */
    box-shadow: none !important;
}

/* LAYER 2: The Main Panel (Middle) */
.controls-content {
    position: relative;
    top: 1px;
    
    /* Z-INDEX 1300: Higher than Tab */
    z-index: 1300 !important; 
    
    /* EXACT COLOR MATCH */
    background-color: var(--drawer-bg) !important;
    
    display: flex; justify-content: center;
    width: 100%; max-width: 600px;
    margin: 0 auto; padding: 8px 12px; gap: 10px;
    
    /* Borders */
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-bottom: none;
    border-radius: 6px 6px 0 0;
}

/* LAYER 2.5: The "Eraser" Patch */
.controls-content::before {
    content: "";
    position: absolute;
    
    /* Position slightly higher to cover the seam aggressively */
    top: -3px; 
    left: 50%;
    transform: translateX(-50%);
    
    /* Width matches the inner width of the tab (80px - borders) */
    width: 78px; 
    
    /* Taller height to ensure full coverage */
    height: 6px; 
    
    /* EXACT COLOR MATCH */
    background-color: var(--drawer-bg);
    
    z-index: 1301;
}

/* --- 4. THE ARROW (White) --- */
.tab-arrow {
  color: transparent; 
  display: block;
  width: 8px;
  height: 8px;
  
  /* WHITE lines to match sidebar icons */
  border-right: 2px solid white;
  border-bottom: 2px solid white;
  
  /* Orientation: Down */
  transform: rotate(45deg) translateY(-2px);
  transition: transform 0.3s ease;
}

/* Arrow Orientation: Up (Closed) */
.controls-drawer.closed .tab-arrow {
  transform: rotate(225deg) translateY(-2px);
}

/* ==========================================
   MOBILE OPTIMIZATIONS (T-Shape Layout)
   ========================================== */
@media (max-width: 768px) {

  /* 1. THE PANEL (ROUNDED & WRAPPED) */
  .controls-content {
    /* Enable wrapping so we can put Map on top, others below */
    display: flex;
    flex-wrap: wrap; 
    justify-content: space-between;
    
    /* ROUND THE SHARP CORNERS */
    border-radius: 12px 12px 0 0 !important;
    border-bottom: none !important;
    
    padding: 10px !important;
    gap: 8px; /* Space between === rows */
    width: 100% !important;
    box-sizing: border-box;
  }

  /* 2. FIRST ITEM (MAP) - FULL WIDTH */
  /* This targets the first dropdown (Map) to make it take the whole top row */
  .controls-content > .custom-dropdown:nth-child(1),
  .controls-content > .btn-map-select:nth-child(1) {
    width: 100% !important;
    flex: 0 0 100% !important;
  }

  /* 3. OTHER ITEMS (FACTION & GUN) - 50% SPLIT */
  /* This targets the 2nd and 3rd items to share the bottom row */
  .controls-content > .custom-dropdown:nth-child(2),
  .controls-content > .custom-dropdown:nth-child(3),
  .controls-content > .btn-map-select:not(:first-child) {
    /* Use calc to share width minus the gap */
    width: calc(50% - 4px) !important;
    flex: 0 0 calc(50% - 4px) !important;
  }

  /* 4. BIGGER DRAWER BUTTON (SCALED UP) */
  .drawer-tab {
    /* Make it wider and taller for touch */
    width: 80px !important; 
    height: 32px !important;
    
    /* Position it to sit perfectly on the rounded corners */
    top: -31px !important; 
    
    /* Center it */
    left: 50%;
    transform: translateX(-50%);
    
    /* Round tab corners */
    border-radius: 10px 10px 0 0 !important;
    z-index: 1300 !important;
  }

  /* 5. TEXT SAFETY */
  /* Ensure long text cuts off with "..." instead of breaking layout */
  .btn-map-select span, 
  #currentMapName, 
  #factionLabel, 
  #gunLabel {
    font-size: 12px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
}

/* ==========================================
   UI CONTROLS
   ========================================== */
.debug-overlay {
  position: absolute; 
  bottom: 0; /* CHANGE: Was 20px. Now 0 to dock it to the edge. */
  left: 50%; 
  transform: translateX(-50%);
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  gap: 5px;
  pointer-events: none; 
  z-index: 100;
}

/* SCALE BAR & ZOOM INDICATOR */
.scale-container { 
  width: 100%; 
  max-width: 400px;
  display: flex; 
  justify-content: center; 
  align-items: flex-end; 
  margin-bottom: 35px;    
  position: relative; 
  padding: 0; 
  
  /* THE FIX: Let touches pass through the empty space around the bar */
  pointer-events: none !important; 
}

.scale-wrapper { 
  display: flex; flex-direction: column; align-items: center; 
  width: 0px; transition: width 0.1s linear; 
}

.scale-bar-graphic {
  position: relative; height: 8px; width: 100%;
  box-sizing: border-box; 
  border: 1px solid rgba(255,255,255,0.5); 
  background: linear-gradient(to right, #ffffff 50%, #000000 50%);
  box-shadow: 0 0 2px black;
}

.scale-tick { 
  position: absolute; bottom: -6px; width: 2px; height: 14px; 
  z-index: 5; background: #fff; box-shadow: 0 0 1px black;
}
.t-start { left: 0; transform: translateX(-50%); }
.t-mid   { left: 50%; transform: translateX(-50%); }
.t-end   { right: 0; transform: translateX(50%); }

.scale-labels { 
  position: relative; width: 100%; height: 16px; margin-top: 4px; 
}

.scale-lbl {
  position: absolute; bottom: 0; transform: translateX(-50%);
  font-family: "GothamSS", sans-serif; font-weight: 900; 
  font-size: 12px; color: #ffffff; white-space: nowrap; 
  text-shadow: 2px 0 0 #000, -2px 0 0 #000, 0 2px 0 #000, 0 -2px 0 #000;
  line-height: 1;
}
.l-start { left: 0%; }
.l-mid { left: 50%; }
.l-end { left: 100%; }

/* ZOOM INDICATOR */
.zoom-indicator-inline {
  /* CHANGE: Moved further right (was -40px) to prevent overlap */
  position: absolute; right: -70px; bottom: 15px; margin-right: 0px; 
  pointer-events: none; 
}

#zoomIndicator {
  color: #ffffff; font-family: "GothamSS", sans-serif; font-weight: 900;
  font-size: 16px; text-shadow: 2px 0 0 #000, -2px 0 0 #000, 0 2px 0 #000, 0 -2px 0 #000;
  display: block; line-height: 1; text-align: right;
}

.controls-row {
  display: flex; align-items: stretch; gap: 10px;
  background: rgba(0,0,0,0.8); padding: 8px 12px; border-radius: 4px;
  width: 100%;
}

/* ==========================================
   LOADING OVERLAY
   ========================================== */
.loading-overlay {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  z-index: 4000; transition: opacity 0.3s ease-out; opacity: 1; pointer-events: auto;
}
.loading-overlay.hidden { opacity: 0; pointer-events: none; }
.loading-spinner {
  width: 40px; height: 40px; border: 4px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%; border-top-color: #fff;
  animation: spin 1s ease-in-out infinite; margin-bottom: 12px;
}
.loading-text {
  color: white; font-size: 16px; font-family: 'GothamSS', sans-serif;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Ensure SVG icons scale with font-size and inherit color */
svg.icon {
  width: 1em;
  height: 1em;
  fill: currentColor;
  display: block; /* Removes baseline gap issues */
}

/* --- MODAL FOOTER ICON SIZE INCREASE --- */

/* Target icons only inside modal footer */
.modal-footer .footer-btn .icon {
    /* Increased from 20px/22px to 28px for better visibility */
    width: 28px !important;
    height: 28px !important;
    
    /* Ensure colors and strokes stay consistent */
    fill: none !important;
    stroke: currentColor !important;
    vector-effect: non-scaling-stroke !important;
}

/* Specific fix for the 'dots' in the calculator icon to make them bigger too */
.modal-footer .footer-btn .icon circle {
    fill: currentColor !important;
    stroke: none !important;
    r: 1.2; /* Slightly larger dots for larger icon */
}

/* Desktop: Adjust spacing for the larger icons */
@media (min-width: 769px) {
    .modal-footer .footer-btn .icon {
        margin-right: 15px !important; /* More breathing room for bigger icon */
    }
    
    .modal-footer .footer-btn {
        padding: 0 30px !important; /* Wider buttons to accommodate size */
    }
}

/* Mobile: Ensure absolute centering stays perfect with the new size */
@media (max-width: 768px) {
    .modal-footer .footer-btn:first-child .icon {
        width: 30px !important; /* Slightly larger on mobile for touch clarity */
        height: 30px !important;
        position: absolute !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
    }

    .modal-footer .footer-btn:last-child .icon {
        width: 24px !important; /* Keep the rocket slightly smaller than the square calc button */
        height: 24px !important;
    }
}


/* --- DESKTOP WHITE BLOCK FIX --- */
@media (min-width: 769px) {
  /* 1. Force the icon to be an outline, not a solid block */
  .modal-footer .footer-btn .icon {
    position: static !important;
    transform: none !important;
    fill: none !important; /* This stops the white background block */
    stroke: currentColor !important; /* This ensures the lines are visible */
    width: 20px !important;
    height: 20px !important;
    margin-right: 12px !important;
    display: inline-block !important;
  }

  /* 2. Specific fix for the tiny dots inside the calculator */
  .modal-footer .footer-btn .icon circle {
    fill: currentColor !important; /* Only the dots should be solid */
    stroke: none !important;
  }

  /* 3. Ensure the button doesn't force absolute centering on desktop */
  .modal-footer .footer-btn:first-child {
    width: auto !important;
    flex: 0 1 auto !important;
    padding: 0 20px !important;
  }
}

/* --- DESKTOP FOOTER ICON ALIGNMENT --- */
@media (min-width: 769px) {
  /* Fix icon position so it sits next to the text */
  .modal-footer .footer-btn .icon {
    position: static !important; /* Removes the absolute centering used for mobile */
    transform: none !important;
    width: 20px !important;
    height: 20px !important;
    margin-right: 12px !important; /* Spacing between icon and "MANUAL CALCULATOR" */
    display: inline-block !important;
    vertical-align: middle;
  }

  /* Ensure the button itself uses flex for horizontal layout */
  .modal-footer .footer-btn {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    justify-content: center !important;
    height: 54px !important;
    width: auto !important; /* Allows button to expand horizontally */
    padding: 0 25px !important;
  }
}

/* --- MOBILE ICON SHARPNESS FIX --- */
@media (max-width: 768px) {
  /* Prevent the footer icons from stretching or blurring */
  .modal-footer .footer-btn .icon {
    /* 1. Reset dimensions to a standard tactical size */
    width: 22px !important;
    height: 22px !important;

    /* 2. Absolute center inside the square button */
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;

    /* 3. CRITICAL: Prevent browser scaling from thickening the lines */
    vector-effect: non-scaling-stroke !important;
    
    /* 4. Ensure it doesn't try to 'fill' the interior */
    fill: none !important;
  }

  /* Specific fix for the 'dots' in the calc icon so they remain visible */
  .modal-footer .footer-btn svg.icon path,
  .modal-footer .footer-btn svg.icon circle {
    vector-effect: non-scaling-stroke !important;
  }
}

/* ==========================================================================
   Base Styles
   ========================================================================== */
/* ==========================================
   ALLOW 2-LINE TEXT WRAPPING
   ========================================== */

/* --- UNIFY THE BASE BUTTON COLOR --- */
.btn-map-select {
  /* Allow height to grow for 2 lines */
  height: auto !important; 
  
  /* Force a minimum height that fits 2 lines of text */
  min-height: 56px !important;
  
  /* Vertical Padding helps when text wraps */
  padding: 4px 10px;
  
  /* Use Flexbox to vertically center single-line text (like 'Germany') */
  display: flex;
  align-items: center; 
  justify-content: space-between;
  
  /* Optional: Ensure text wrapping for long map names */
  white-space: normal;
  line-height: 1.2;
  text-align: left;
  
  /* CHANGE: Replace the gradient with a solid charcoal to match the menu */
  background: rgba(29, 31, 39, 0.9) !important; 
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-left: 3px solid #ffc107; 
  border-radius: 0 3px 3px 0; 
  
  /* Keep your existing Gotham font styles */
  color: white;
  font-family: 'GothamSS', sans-serif; 
  font-weight: 900;
  font-size: 13px; 
  text-transform: uppercase; 
  letter-spacing: 0.5px;
  cursor: pointer; 
  pointer-events: auto;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  transition: background 0.2s ease;
}

/* 2. Text Labels: Fix Wrapping Logic */
#currentMapName,
#factionLabel,
#gunLabel {
  /* ENABLE WRAPPING but keep words intact */
  white-space: normal;       /* Allow wrapping */
  
  /* CRITICAL FIX: Stop breaking words like "BRITI-SH" */
  word-break: normal;        
  overflow-wrap: break-word; /* Only break if a single word is wider than the box */
  
  /* Layout improvements */
  line-height: 1.1;       
  text-align: left;          /* Or 'center' if you prefer */
  margin-right: 4px;         /* Reduced margin to give text more space */
  display: block; 
  flex: 1;
}

/* Active state for faction button when dropdown is open */
.btn-map-select.active {
    background-color: rgba(45, 48, 60, 1) !important; /* Slightly lighter when menu is open */
}

button.btn-map-select:active {
  background: rgba(60, 60, 60, 1);
}

select.btn-map-select {
  appearance: none; -webkit-appearance: none; -moz-appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
  background-repeat: no-repeat; background-position: right 8px center;
  background-size: 14px; padding-right: 28px; height: 100%;
}

select.btn-map-select option {
  background-color: #1d1f27; color: #ffffff; padding: 12px;
}

.btn-map-select.compact {
  min-width: auto; padding: 12px 15px; font-size: 14px; gap: 15px;
  border-left: 1px solid rgba(255,255,255,0.2); 
  height: 32px;
}

.btn-map-select .icon {
  font-size: 14px; color: rgba(255,255,255,0.5);
  transition: color 0.2s, transform 0.2s ease; display: inline-block;
}

.btn-map-select.active .icon { transform: rotate(180deg); color: white; }
@media (hover: hover) {
  .btn-map-select:hover .icon { color: white; }
}

/* ==========================================
   MAP SELECTOR GRID (FIXED)
   ========================================== */
.modal-overlay {
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background-color: rgba(0, 0, 0, 0.85);
  display: flex; justify-content: center; align-items: center;
  z-index: 3000; transition: opacity 0.2s ease-in-out; opacity: 0; pointer-events: none;
  backdrop-filter: blur(5px);
}
.modal-overlay.active { opacity: 1; pointer-events: all; }

.modal-content {
  background-color: #15171e; border: 1px solid rgba(255,255,255,0.15);
  border-radius: 6px; width: 90%; max-width: 1100px; height: 85%; /* Increased height slightly */
  overflow-y: hidden; box-shadow: 0 0 30px rgba(0,0,0,0.9);
  display: flex; flex-direction: column;
  transform: translateY(20px); transition: transform 0.2s ease-in-out;
}
.modal-overlay.active .modal-content { transform: translateY(0); }

/* ==========================================
   MODAL HEADERS (UPDATED X POSITION)
   ========================================== */

.modal-brand-header {
  position: relative; /* REQUIRED to anchor the X button */
  padding: 25px 20px;
  background: rgba(0, 0, 0, 0.4); 
  border-bottom: 1px solid rgba(255, 193, 7, 0.3); 
  
  font-family: 'GothamSS', sans-serif;
  font-weight: 900;
  font-size: 32px; 
  color: #ffc107; 
  
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 2px;
  text-shadow: 0 0 15px rgba(255, 193, 7, 0.4); 
  flex-shrink: 0;
}

.modal-subtitle-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  width: 100%;
}

.modal-search-wrapper {
  position: relative;
  width: 100%;
  max-width: 400px;
}

#mapSearchInput {
  width: 100%;
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid rgba(255, 193, 7, 0.3);
  border-radius: 4px;
  padding: 10px 40px 10px 15px;
  color: white;
  font-family: 'GothamSS', sans-serif;
  font-weight: 700;
  font-size: 13px;
  letter-spacing: 1px;
  text-transform: uppercase;
  outline: none;
  transition: border-color 0.2s;
}

#mapSearchInput:focus {
  border-color: #ffc107;
  background: rgba(0, 0, 0, 0.6);
}

.search-clear-btn {
  position: absolute;
  right: 12px; /* Move to right edge since search icon is removed */
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.4);
  font-size: 20px;
  cursor: pointer;
  padding: 5px;
  display: none; /* Hidden by default */
  line-height: 1;
  transition: color 0.2s;
}

@supports (-moz-appearance: none) {
  .search-clear-btn {
    top: 45%; /* Adjust for Firefox */
  }
}

.search-clear-btn:hover {
  color: #ff4444;
}

/* Show the clear button only when there is text in the input */
#mapSearchInput:not(:placeholder-shown) ~ .search-clear-btn {
  display: block;
}

.modal-sub-header {
  padding: 15px 25px;
  background: rgba(255, 255, 255, 0.03); 
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  display: flex; 
  justify-content: center; 
  align-items: center;
  flex-shrink: 0;
}

.modal-subtitle {
  font-family: 'GothamSS', sans-serif; 
  font-size: 14px; 
  font-weight: 700;
  color: rgba(255, 255, 255, 0.7); 
  text-transform: uppercase; 
  letter-spacing: 1.5px;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.arrow-down {
  color: #ffc107;
  font-size: 12px;
  opacity: 0.8;
}

.close-btn {
  position: absolute; 
  right: 15px;         /* Move to corner */
  top: 10px;           /* Pin to top */
  transform: none;     /* Remove the centering transform */
  
  background: none; 
  border: none; 
  color: rgba(255, 255, 255, 0.4); 
  font-size: 32px; 
  line-height: 1; 
  cursor: pointer; 
  padding: 0;
  transition: all 0.2s ease;
  z-index: 2000;       /* Ensure it sits on top of everything */
}

/* Hover effect */
.close-btn:hover { 
  color: #ff4444; 
  transform: scale(1.1); /* Subtle zoom only */
}

/* Mobile Tweak to keep it accessible */
@media (max-width: 768px) {
  .modal-brand-header {
    font-size: 18px; 
    padding: 18px 10px;
    
    /* CRITICAL FIX: Reserve space on the right for the X button 
       so the text wraps instead of hiding the button */
    padding-right: 50px; 
    position: relative;
  }
  
  .close-btn {
    right: 10px;
    top: 10px;
    font-size: 32px;
    
    /* Add padding to make the touch target easier to hit */
    padding: 10px; 
  }
  
  .modal-subtitle {
    font-size: 11px !important;
    letter-spacing: 1px;
    gap: 6px;
  }
  
  .arrow-down {
    font-size: 10px;
  }
}

.map-grid {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: grid;
  /* CHANGE: Use grid-auto-rows to ensure all rows are exactly the same height */
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  grid-auto-rows: min-content; 
  align-content: start; /* Forces the grid to the top of the container */
  gap: 15px;
  width: 100%;
  box-sizing: border-box;
}

/* ========================================== */
/*   MAP SELECTOR GRID IMAGE FIX              */
/* ========================================== */
.map-card {
    position: relative;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    background: #111; /* Dark background while loading */
    border: 2px solid transparent;
    width: 100%;
    aspect-ratio: 16 / 9; /* Modern replacement for the padding-bottom hack */
    height: auto;
    transition: transform 0.2s, border-color 0.2s;
}

.map-card-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    opacity: 1 !important; /* Force visibility */
    transition: transform 0.3s ease;
}

/* Ensure the green highlight beats everything */
.map-card.active {
    border-color: #28a745 !important;
}

/* Mobile: Disable hover effects that might hide images */
@media (max-width: 768px) {
    .map-card:hover {
        transform: none;
    }
    .map-card-img {
        opacity: 1 !important;
    }
}

.map-card-name {
  position: absolute; bottom: 0; left: 0; right: 0;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.95), transparent);
  color: white; padding: 8px 10px;
  font-family: 'GothamSS', sans-serif; font-size: 13px; font-weight: 700;
  text-transform: uppercase; pointer-events: none; text-shadow: 0 1px 2px black;
}

/* 3. NEW: Modal Footer */
.modal-footer {
  padding: 15px 20px;
  background: rgba(0, 0, 0, 0.6);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  justify-content: center;
  gap: 15px;
  flex-shrink: 0; /* Prevents shrinking */
}

/* 4. NEW: Footer Buttons */
.footer-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.8);
  font-family: 'GothamSS', sans-serif;
  font-weight: 700;
  font-size: 13px;
  padding: 12px 24px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.footer-btn .icon {
  font-size: 16px;
  filter: grayscale(1); /* Muted icon */
}

.footer-btn:hover {
  background: rgba(255, 193, 7, 0.1);
  border-color: #ffc107;
  color: #ffc107;
  box-shadow: 0 0 15px rgba(255, 193, 7, 0.1);
}

.footer-btn:hover .icon {
  filter: none; /* Color icon on hover */
}

/* Optional: Different style for "Other Projects" if you want */
.footer-btn.secondary {
  border-color: rgba(255, 255, 255, 0.1);
}

/* Mobile Tweak for Footer */
@media (max-width: 768px) {
  .modal-footer {
    flex-direction: column;
  }
  .footer-btn {
    width: 100%;
    justify-content: center;
  }
}

/* Mobile Support for Map Grid */
@media (max-width: 768px) {
  .map-grid { 
     /* CHANGE: Maintain the start alignment to prevent vertical centering gaps */
     grid-template-columns: repeat(2, 1fr); 
     grid-auto-rows: min-content;
     align-content: start;
     gap: 10px; 
     padding: 10px; 
  }
}

/* ==========================================
   CUSTOM DROPDOWNS
   ========================================== */
.custom-dropdown {
  position: relative; 
  height: auto; 
  display: flex; 
  flex-direction: column;
  /* Above the 'Eraser' patch and Tab */
  z-index: 1400 !important;
}

/* --- UNIFY THE DROPDOWN MENU COLOR --- */
.dropdown-menu {
  position: absolute;
  bottom: 100%;
  left: 0;
  width: 100%;
  min-width: 150px;
  
  /* MATCH: Use the exact same color as the button */
  background-color: rgba(29, 31, 39, 0.95) !important;
  border: 1px solid rgba(255, 255, 255, 0.15);
  
  /* Use backdrop blur to match the premium look of the other panels */
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  
  border-radius: 4px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.8);
  z-index: 9999 !important;
  opacity: 1; transform: translateY(0); transition: opacity 0.15s, transform 0.15s;
  pointer-events: auto;
}

.dropdown-menu.hidden {
  opacity: 0; pointer-events: none; transform: translateY(10px);
}

.dropdown-item {
  padding: 12px 15px; color: white; font-family: 'GothamSS', sans-serif;
  font-weight: 700; font-size: 14px; cursor: pointer;
  transition: background 0.1s; border-bottom: 1px solid rgba(255,255,255,0.05);
}
.dropdown-item:last-child { border-bottom: none; }
/* --- HOVER STATE UNIFICATION --- */
.dropdown-item:hover,
button.btn-map-select:hover {
  /* Use a lighter grey for the hover highlight */
  background-color: rgba(60, 64, 75, 1) !important;
  color: #ffc107; /* Tactical yellow text on hover */
}

.dropdown-item:hover { border-left-color: #ffffff; }
button.btn-map-select:hover { border-left-color: #ffffff; }

/* ==========================================
   TRAJECTORY & TARGETING (SHARP FIX)
   ========================================== */

/* 1. Trajectory Line */
.trajectory-visual {
  /* Set much higher to clear everything */
  z-index: 100 !important; 
  position: absolute;
  pointer-events: none;
}

.trajectory-visual line {
  stroke-width: 3px;
  stroke: #ff0000; 
  stroke-linecap: butt; 
  shape-rendering: geometricPrecision;
  vector-effect: non-scaling-stroke !important; 
}

/* 1. Impact Circles Container Fix */
/* 1. Impact Circles Container Fix */
.impact-circles-svg {
  position: absolute;
  /* Ensure it sits above the map (z-index 0) and markers (z-index 50) */
  z-index: 100 !important; 
  
  /* FIX: Give it a 1px size so Mobile Chrome doesn't cull/delete it */
  width: 1px !important;
  height: 1px !important;
  
  /* Let's circles flow outside that 1px box */
  overflow: visible;
  pointer-events: none;
  
  /* Reset offsets */
  top: 0;
  left: 0;
  
  /* FIX: Force hardware acceleration on the container to prevent flickering */
  transform: translateZ(0);
  will-change: transform;
}

/* 2. Impact Marker (The "X") */
.impact-marker {
  position: absolute; 
  width: 4px;
  height: 4px;
  transform: translate(-50%, -50%); 
  pointer-events: none;
}

.impact-marker::before,
.impact-marker::after {
  content: ''; 
  position: absolute; 
  top: 50%; 
  left: 0; 
  width: 100%; 
  height: 1px;
  background-color: #000; /* Original black color */
  box-shadow: 0 0 1px rgba(255, 255, 255, 0.4); 
}

.impact-marker::before { transform: translateY(-50%) rotate(45deg); }
.impact-marker::after  { transform: translateY(-50%) rotate(-45deg); }

/* Ruler tick marks (The Balls) */
.trajectory-visual .ruler-tick {
    fill: #ff4444; /* Tactical Red */
    stroke: #ffffff; /* White outline for contrast */
    stroke-width: 1px;
    /* Optional: add a slight outer glow to make it stand out more */
    filter: drop-shadow(0 0 1px rgba(0,0,0,0.8));
}

/* Ruler distance labels */
.trajectory-visual .ruler-text {
  fill: #000000;
  font-size: 10px;
  font-family: 'Roboto-Black', sans-serif;
  font-weight: 900;
  text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
  dominant-baseline: middle; /* Helps with rotation centering */
  paint-order: stroke;
  stroke: rgba(0,0,0,0.5); /* Adds a thin outline for better contrast on any map */
  stroke-width: 0.5px;
  display: none; /* Hide meter text since we're only showing mil boxes now */
}

/* Ruler MIL Label Container */
.ruler-mil-label {
    position: absolute;
    z-index: 105;
    font-family: 'GothamSS', sans-serif;
    padding: 3px 6px; /* Slightly more vertical padding */
    background-color: rgba(20, 20, 20, 0.85);
    border-radius: 2px;
    text-align: center;
    white-space: nowrap;
    pointer-events: none;
    transform: translate(-50%, -100%);
    margin-top: -10px;
    display: flex;
    flex-direction: column; /* Stack mil over meters */
    align-items: center;
    gap: 0px;
}

/* The MIL Number (Yellow) */
.ruler-mil-label .mil-value {
    font-size: 14px;
    font-weight: 700;
    color: #ffc107;
    line-height: 1.1;
}

/* THE FIX: The Meter Subtext (Small White) */
.ruler-mil-label .meter-subtext {
    font-size: 7px;
    font-weight: 400;
    color: #ffffff; /* White text */
    opacity: 0.9;
    line-height: 1;
    margin-top: 1px;
}

/* The Arrow for the MIL Label */
.ruler-mil-label::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid rgba(20, 20, 20, 0.85);
}

/* Ruler toggle button states */
#rulerToggleBtn.active {
  background-color: #ffc107;
  color: #000;
}

#rulerToggleBtn:not(.active) {
  background-color: #1d1f27;
  color: white;
}

/* Hidden ruler elements */
.trajectory-visual.ruler-hidden .ruler-tick,
.trajectory-visual.ruler-hidden .ruler-text,
.trajectory-visual.ruler-hidden .ruler-mil-text {
  display: none;
}

/* 2. Impact Circles Common */
.deadzone-circle, 
.dispersion-circle, 
.blast-circle {
  vector-effect: non-scaling-stroke !important; /* CRITICAL: Forces redraw at screen resolution */
  shape-rendering: geometricPrecision;
  z-index: 30; 
}

/* 3. Specifics */
.deadzone-circle {
  stroke-width: 1px; 
  stroke: rgba(255, 0, 0, 0.3); 
  fill: rgba(255, 0, 0, 0.3); 
}

.dispersion-circle {
  stroke-width: 2px; 
  stroke: rgba(0, 0, 0, 0.6); 
  stroke-dasharray: 4px 4px; /* Dash stays crisp during zoom */
  fill: rgba(255, 0, 0, 0.2); 
}

/* --- THE FIX FOR BLURRY RED CIRCLE --- */
.blast-circle {
  stroke: none; 
  fill: rgba(255, 0, 0, 0.4); 
  
  /* FIX: REMOVED 'transform: translateZ(0)' 
     This forces Chrome to re-draw the vector at high quality 
     on every zoom level instead of stretching a bitmap. */
}

/* --- FIRE CONTROL PANEL UPDATES --- */
/* --- FIRE CONTROL PANEL UPDATES --- */

/* 1. Panel Container (Desktop) */
.target-data-panel {
  position: absolute; top: 110px; left: 50%; transform: translateX(-50%);
  display: flex; align-items: center; justify-content: center;
  background: linear-gradient(180deg, rgba(20,20,20,0.95) 0%, rgba(10,10,10,0.95) 100%);
  border: 1px solid rgba(255, 255, 255, 0.15); border-top: 4px solid #ffc107;
  border-radius: 0 0 6px 6px; box-shadow: 0 8px 30px rgba(0,0,0,0.9);
  z-index: 500; 
  height: auto; 
  min-height: 70px; 
  
  /* Allow width to adjust based on content */
  width: auto; 
  min-width: 340px;
  
  pointer-events: none; transition: opacity 0.2s, top 0.2s;

  /* THE FIX: Increased padding for desktop 
     Top: 10px | Side: 15px | Bottom: 15px (Added +5px here) */
  padding: 10px 15px 15px 15px; 
}

.target-data-panel.hidden { 
  opacity: 0; 
  pointer-events: none; 
  transition: none;
}

.data-divider {
  width: 1px; height: 40px;
  background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.15), transparent);
  margin: 0 10px;
}

/* 2. Label Styling */
.data-label {
  font-family: 'GothamSS', sans-serif; 
  font-size: 10px; 
  color: rgba(255, 255, 255, 0.4);
  font-weight: 700; 
  letter-spacing: 1.5px; 
  text-transform: uppercase; 
  
  /* CRITICAL: Keep nowrap so it doesn't break on any screen */
  white-space: nowrap; 

  /* THE FIX: Slight gap between label and number */
  margin-bottom: 5px; 
}

.data-col { display: flex; flex-direction: column; align-items: center; justify-content: center; }
.small-col { width: 60px; }
.main-col { flex: 1; padding: 0 10px; }

.val-small {
  font-family: 'GothamSS', sans-serif; font-size: 18px; font-weight: 900; color: rgba(255,255,255,0.9);
  margin-top: 0;
}

/* 3. Huge Value (Your custom style preserved) */
.val-huge {
  font-family: 'GothamSS', sans-serif; 
  font-size: 40px; 
  line-height: 0.8; 
  font-weight: 900; 
  color: #ffc107; 
  text-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
  margin-top: 5px; 
}

.text-green { color: #00ff00; }
.text-red { color: #ff4444; font-size: 24px; }

/* ==========================================
   PANEL WATERMARK (Hovering Topside)
   ========================================== */
.panel-watermark {
  position: absolute;
  /* Anchor to the top of the panel with 10px extra spacing */
  bottom: calc(100% + 5px); 
  left: 0;
  width: 100%;
  
  /* Spacing from the yellow border */
  padding-bottom: 4px; 
  
  text-align: center;
  font-family: 'GothamSS', sans-serif;
  font-weight: 900;
  font-size: 10px;
  letter-spacing: 1px;
  
  /* CHANGE: Reduced opacity for a true watermark look (0.35 = 35% visible) */
  color: rgba(46, 45, 45, 0.6); 
  
  text-transform: uppercase;
  pointer-events: none;
  user-select: none;
  white-space: nowrap; 
  
}

/* Mobile Adjustment */
@media (max-width: 768px) {
  .panel-watermark {
    font-size: 9px;
    padding-bottom: 2px;
    letter-spacing: 0.5px;
  }
}

/* Force hide old classes to clean up */
.panel-credits, .watermark-credits {
  display: none !important;
}

/* ==========================================
   VERTICAL ZOOM SLIDER
   ========================================== */
.zoom-slider-container {
  position: absolute; right: 40px; top: 50%; transform: translateY(-50%);
  height: 400px; 
  width: 40px; 
  display: flex; flex-direction: column;
  align-items: center; gap: 20px; z-index: 100; 
  
  /* THE FIX: Let touches pass through the gaps between buttons */
  pointer-events: none !important; 
}

.zoom-slider-track {
  position: relative; flex: 1; 
  width: 24px; 
  background-color: rgba(0, 0, 0, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0; cursor: pointer;
  
  pointer-events: auto !important; /* Allow clicking the slider track */
}

.zoom-slider-fill {
  position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; 
  background-color: #ffc107; border-radius: 0; pointer-events: none;
}

.zoom-slider-handle {
  position: absolute; left: 50%; bottom: 0%; transform: translate(-50%, 50%); 
  width: 24px; height: 16px; background-color: #ffffff;
  border: 2px solid #000000; border-radius: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.8);
  cursor: grab; touch-action: none; 
  
  pointer-events: auto !important; /* Allow grabbing the handle */
}

.zoom-slider-handle:active {
  cursor: grabbing; background-color: #ffc107; border-color: #fff;
}

.zoom-icons {
  display: flex; flex-direction: column; gap: 8px; width: 100%; align-items: center;
}

.zoom-icons span {
  width: 32px; height: 32px; background-color: rgba(20, 20, 20, 0.95);
  pointer-events: auto !important; /* Allow clicking the buttons (+, -, etc.) */
  color: white; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 0; 
  display: flex; align-items: center; justify-content: center;
  font-family: 'GothamSS', sans-serif; font-weight: 900; font-size: 20px;
  cursor: pointer; user-select: none; transition: background-color 0.1s;
  -webkit-tap-highlight-color: transparent; 
}

@media (hover: hover) {
  .zoom-icons span:hover {
    background-color: #ffc107; color: black; border-color: #ffc107;
  }
}

.zoom-icons span:active,
.zoom-icons span.pressed {
  background-color: #ffc107 !important; color: black !important;
  border-color: #ffc107 !important; transform: scale(0.95);
}

/* Ensure the Ruler icon inside the zoom slider looks correct */
#rulerToggleBtn svg {
    display: block;
    pointer-events: none;
}

/* 1. Base State (Off) */
#rulerToggleBtn {
    background-color: rgba(20, 20, 20, 0.95) !important;
    color: white !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    touch-action: manipulation; /* Removes 300ms browser delay */
    -webkit-tap-highlight-color: transparent; /* Optional: removes tap highlight box */
    user-select: none; /* Prevents text selection on rapid taps */
    transition: background-color 0.1s, color 0.1s;
}

/* 2. Hover State (Only applies when NOT active to show it's clickable) */
@media (hover: hover) {
    #rulerToggleBtn:not(.active):hover {
        background-color: rgba(60, 60, 60, 1) !important;
        color: #ffc107 !important;
    }
}

/* 3. Active State (ON - Always Yellow) */
#rulerToggleBtn.active {
    background-color: #ffc107 !important;
    color: black !important;
    border-color: #ffc107 !important;
}

/* 4. Active + Hover (Slightly darker yellow so you see click happened) */
@media (hover: hover) {
    #rulerToggleBtn.active:hover {
        background-color: #e5ad06 !important; /* Slightly darker gold */
    }
}

/* ==========================================
   MOBILE & TABLET OPTIMIZATIONS
   ========================================== */
/* ==========================================
   MOBILE LAYOUT FIX (Stacking Context & Merge)
   ========================================== */
@media (max-width: 768px) {

  /* 1. THE PANEL (Now Highest Layer) */
  .controls-content {
      z-index: 1300 !important; /* CHANGE: Higher than Tab */
      position: relative;
      background-color: #181818 !important;
      
      /* Borders */
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-bottom: none !important;
      border-radius: 12px 12px 0 0 !important;
      
      /* Layout */
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      padding: 10px !important;
      gap: 8px;
  }

  /* 2. THE VISUAL PATCH (Hides the border line) */
  /* This creates a small black strip on top of the panel border 
     where the tab sits, creating the "merged" look */
  .controls-content::before {
      content: "";
      position: absolute;
      top: -2px; /* Shift up to cover the border */
      left: 50%;
      transform: translateX(-50%);
      width: 78px; /* Slightly narrower than tab (80px) */
      height: 4px; 
      background-color: #181818; /* Matches Panel BG */
      z-index: 1301;
  }

  /* 3. THE DRAWER TAB (Now Lower Layer) */
  .drawer-tab {
      top: -31px !important;
      height: 32px !important;
      width: 80px !important;
      
      z-index: 1000 !important; /* CHANGE: Lower than Panel */
      
      background-color: #181818 !important;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-bottom: none !important;
      border-radius: 10px 10px 0 0 !important;
      box-shadow: none !important;
  }

  /* 4. THE DROPDOWNS (Free to float on top) */
  /* Now that the parent Panel is 1300, these are safe */
  .custom-dropdown {
      position: relative;
      z-index: 1400 !important; 
  }
  
  .dropdown-menu {
      z-index: 1500 !important;
  }

  /* --- Rest of Layout Logic --- */
  
  /* Map Button - Full Width */
  .custom-dropdown:nth-child(1) {
      width: 100% !important;
      flex: 0 0 100% !important;
  }

  /* Faction & Gun - 50% Split */
  .custom-dropdown:nth-child(2),
  .custom-dropdown:nth-child(3) {
      width: calc(50% - 4px) !important;
      flex: 0 0 calc(50% - 4px) !important;
  }

  /* Button Styling */
  .btn-map-select {
      font-size: 13px !important;
      padding: 10px 12px !important;
      min-height: 48px !important;
      background: rgba(29, 31, 39, 0.9) !important;
  }

  /* Hide Desktop Elements */
  #desktopCursorRings, #liveCursorHud { 
      display: none !important; 
  }

  /* Prevent the default mobile tap highlight gray box on the ruler icon */
  #rulerToggleBtn {
    -webkit-tap-highlight-color: transparent;
    transition: transform 0.1s ease;
  }

  /* Visual feedback that it was pressed */
  #rulerToggleBtn:active {
    transform: scale(0.9);
  }

  .shell { padding: 0; }
  .arty-icon { filter: none !important; }
  .marker.active-gun::before { animation: none !important; box-shadow: 0 0 4px #ffc107; }
  .marker-label { box-shadow: none !important; }

  .modal-brand-header {
    font-size: 18px; 
    padding: 18px 40px; /* Equal padding left/right keeps text centered */
    position: relative;
    
    /* Ensure text wraps nicely if too long */
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 60px; /* Ensure enough height for the X button */
  }
  
  .close-btn {
    position: absolute;
    right: 10px;
    top: 15px;
    font-size: 32px;
    padding: 10px; /* Hit area */
    line-height: 1;
    z-index: 2005; 
  }

  /* --- MOBILE OPTIMIZATIONS --- */
@media (max-width: 768px) {
  .target-data-panel {
    top: 50px; 
    
    /* Compact padding for mobile */
    padding: 8px 10px 8px 10px; 
    
    min-width: 300px;
    max-width: 95vw; 
  }
  
  .data-label {
    font-size: 9px;       
    margin-bottom: 2px;   /* Tighter spacing for mobile */
  }

  .val-huge {
    font-size: 32px; 
    margin-top: 2px;      
    line-height: 1;       
  }
  
  .val-small { font-size: 14px; }
  
  /* Compact Columns for Mobile */
  .target-data-panel .small-col { width: 50px; } 
  .target-data-panel .main-col { padding: 0 5px; } 
  .target-data-panel .data-divider { margin: 0 5px; } 
}

  /* Optional: Make text slightly smaller on mobile to fit */
  .panel-credits {
    font-size: 8px;
    bottom: 3px;
  }

  .debug-overlay {
    top: auto; bottom: 0; width: 100%; left: 0; transform: none;
    background: none; /* Removed the dark linear-gradient shadow */
    padding-bottom: env(safe-area-inset-bottom); pointer-events: none; z-index: 600;
    display: flex; flex-direction: column; justify-content: flex-end;
  }

  /* 1. Container Row: Force items to stretch to equal height */
  .controls-row {
    pointer-events: auto; 
    width: 100%; 
    margin: 0; 
    padding: 8px;
    background: rgba(0,0,0,0.8); 
    border-radius: 4px; 
    gap: 8px; 
    
    /* CRITICAL FIXES: */
    display: flex;             
    flex-wrap: nowrap;         /* Keep them side-by-side */
    align-items: stretch;      /* Force children to same height */
    height: auto;              /* Let content dictate height, but they will match */
  }

  .scale-container {
    pointer-events: auto; 
    margin-bottom: 30px; 
    padding-left: 0; 
    padding-right: 0;
    width: 100%;
  }

  /* 2. Dropdown Wrapper: Must grow to fill height */
  .custom-dropdown {
    flex: 1;          /* Each takes 50% space */
    width: 50%;       
    display: flex;    /* Make THIS a flex container too */
    flex-direction: column;
    height: auto;     /* Allow it to grow */
  }

  /* 3. The Button Itself: Fill the wrapper's height */
  .btn-map-select {
    width: 100%; 
    font-size: 11px; 
    padding: 6px 8px; 
    
    /* CRITICAL FIXES: */
    flex-grow: 1;     /* Grow to fill vertical space */
    height: 100% !important; /* Force full height of parent */
    min-height: 44px; /* Minimum touch target size */
    
    /* Ensure text centers nicely if one is taller */
    display: flex;
    align-items: center; 
  }
  
  /* Tweak font size for labels on mobile so "British 8th Army" fits */
  #factionLabel, #gunLabel {
      font-size: 10px !important; /* Slightly smaller to fit long names better */
      line-height: 1.2;
  }
  
  /* Ensure the map name also looks consistent */
  #currentMapName {
      font-size: 11px !important;
  }

  .hll-grid-label {
    font-size: 18px !important; 
    font-weight: 900; 
    color: #ffffff;
    text-shadow: 2px 0 0 #000, -2px 0 0 #000, 0 2px 0 #000, 0 -2px 0 #000, 1px 1px 2px black;
    z-index: 55; 
    pointer-events: none;
  }

  #labelLayer { pointer-events: none; }

  .zoom-slider-container {
    right: 5px; 
    
    /* --- CHANGE: Increased height from 180px to 260px --- */
    height: 260px; 
    /* ---------------------------------------------------- */
    
    top: 55%; /* Slightly adjusted centering to fit the taller slider */
  }
  
  .map-grid { 
     grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; 
  }

  /* --- INCREASE MOBILE TEXT SIZE (UPDATED) --- */
  #currentMapName, 
  #factionLabel, 
  #gunLabel {
      font-size: 14px !important;  /* Increased to 14px */
      line-height: 1.1 !important; 
      font-weight: 900 !important; 
      letter-spacing: 0.5px;       
  }

  /* Make the dropdown arrows match */
  .btn-map-select .icon {
      font-size: 14px !important; 
  }
  
  /* Ensure padding handles the larger text */
  .btn-map-select {
      padding: 8px 10px !important; 
  }
}

/* --- MANUAL CALCULATOR STYLES --- */

/* Specific Modal Size for Calc - FIX: Remove fixed height */
.calc-content {
  max-width: 400px !important;
  height: auto !important; /* Shrinks to fit content */
  max-height: 90vh;
  display: flex;
  flex-direction: column;
}

/* Faction Bar */
.calc-faction-bar {
  background: rgba(255, 255, 255, 0.05);
  padding: 10px 20px;
  display: flex;
  align-items: center;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  cursor: pointer;
  transition: background 0.2s;
}
.calc-faction-bar:hover { background: rgba(255, 255, 255, 0.1); }

.calc-faction-label {
  font-family: 'GothamSS', sans-serif;
  font-size: 10px; color: rgba(255,255,255,0.5);
  margin-right: 10px;
}
.calc-faction-text {
  font-family: 'GothamSS', sans-serif;
  font-weight: 900; color: white;
  flex: 1;
}
.btn-swap {
  background: none; border: none; color: #ffc107;
  font-size: 18px; cursor: pointer;
}

/* Screen Area */
.calc-screen {
  background: #000;
  padding: 20px;
  border-bottom: 4px solid #ffc107;
}

.screen-row { 
  display: flex; 
  flex-direction: column; 
  align-items: center; /* CHANGED: Centers items horizontally (was flex-end) */
  justify-content: center;
  margin-bottom: 15px; 
  text-align: center; /* Ensures text stays centered */
}
.screen-label { font-family: 'GothamSS', sans-serif; font-size: 10px; color: #888; margin-bottom: 4px; }
/* Screen Input (Target Distance) - Reduced Size */
.screen-input {
  font-family: 'GothamSS', sans-serif; 
  font-weight: 900;
  font-size: 36px; /* Reduced from 48px to 36px */
  color: white; 
  line-height: 1;
}

.screen-divider { height: 1px; background: rgba(255,255,255,0.1); margin: 15px 0; }

/* Screen Results Area */
.screen-results { 
  display: flex; 
  /* Center the single item horizontally */
  justify-content: center; 
  align-items: center;
  width: 100%;
}

.res-box { 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  text-align: center;
  /* CHANGED: Let it take full width (was 48%) */
  width: 100%; 
}

/* Ensure labels are centered */
.res-label { 
  font-family: 'GothamSS', sans-serif; 
  font-size: 10px; 
  color: #888; 
  margin-bottom: 5px; 
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Result Value Container - Fixed Height to prevent jumping */
.res-value { 
  font-family: 'GothamSS', sans-serif; 
  font-weight: 900; 
  line-height: 1; 
  
  /* THE FIX: Force a minimum height equal to font size */
  min-height: 48px; 
  display: block; /* Required for min-height to work */
}

/* Elevation (Yellow) - Big */
.text-yellow.res-value {
  font-size: 48px; 
}

/* Error State (Red) - Ensure it matches the height */
.text-red.res-value {
  font-size: 48px; /* Match yellow size so layout doesn't shift */
  color: #ff4444;
}

.text-yellow { color: #ffc107; text-shadow: 0 0 10px rgba(255, 193, 7, 0.3); }
.text-green { color: #28a745; text-shadow: 0 0 10px rgba(40, 167, 69, 0.3); }

/* Keypad Grid */
.calc-keypad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1px;
  background: rgba(255, 255, 255, 0.1); /* Grid lines color */
  padding-top: 1px;
}

.key {
  background: #1d1f27;
  border: none;
  height: 70px;
  color: white;
  font-family: 'GothamSS', sans-serif;
  font-size: 24px;
  font-weight: 700;
  cursor: pointer;
  transition: background 0.1s;
}

.key:active { background: #333; }
.key.action { background: #252830; font-size: 20px; }
.key.action.red { color: #ff4444; }

/* Add to your CSS file */
.key.pressed {
  background-color: #ffc107 !important; /* Yellow flash */
  color: #000 !important;
  transform: scale(0.95);
}

/* --- LIVE CURSOR HUD STYLES --- */

/* 1. The Toggle Button (Matches Ruler Button Logic) */
#hudToggleBtn svg {
    display: block;
    pointer-events: none;
}

#hudToggleBtn {
    background-color: rgba(20, 20, 20, 0.95) !important;
    color: white !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    touch-action: manipulation; /* Removes 300ms browser delay */
    -webkit-tap-highlight-color: transparent; /* Optional: removes tap highlight box */
    user-select: none; /* Prevents text selection on rapid taps */
    transition: background-color 0.1s, color 0.1s;
}

@media (hover: hover) {
    #hudToggleBtn:not(.active):hover {
        background-color: rgba(60, 60, 60, 1) !important;
        color: #ffc107 !important;
    }
}

/* Active State (ON - Yellow) */
#hudToggleBtn.active {
    background-color: #ffc107 !important;
    color: black !important;
    border-color: #ffc107 !important;
}

/* Visual feedback on press */
#hudToggleBtn:active {
    transform: scale(0.95);
}

/* 2. The Floating HUD Box */
.live-hud {
    position: fixed; /* Fixed relative to screen, JS updates top/left */
    /* CHANGE 1: Lower Z-Index significantly (below the drawer's 700) */
    z-index: 100 !important;   
    background: rgba(15, 15, 15, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-left: 3px solid #ffc107;
    padding: 8px 12px;
    border-radius: 0 4px 4px 0;
    pointer-events: none; 
    box-shadow: 2px 4px 10px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 90px;
}

.live-hud.hidden {
    display: none;
}

.hud-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
}

.hud-label {
    font-family: 'GothamSS', sans-serif;
    font-size: 10px;
    font-weight: 700;
    color: #888;
    letter-spacing: 0.5px;
}

.hud-value {
    font-family: 'GothamSS', sans-serif;
    font-size: 14px;
    font-weight: 900;
    color: white;
}

.hud-value.text-yellow { color: #ffc107; }
.hud-label.text-yellow { color: #ffc107; }

/* 3. Mobile Adjustment: Fix HUD to bottom-left instead of following touch */
@media (max-width: 768px) {
    /* Increase Zoom Slider container height to fit the 4th button */
    .zoom-slider-container {
        height: 360px; /* Increased from 310px to fit the 5th button */
        top: 50%;      /* Recenter */
        pointer-events: none !important; /* Ensure mobile container also passes touches */
    }

    /* 1. Ensure scale container doesn't hide children */
    .scale-container {
        display: flex;
        flex-direction: column; /* Stack scale bar and zoom text */
        align-items: center;
        width: 100%;
        margin-bottom: 40px; /* Space for control panel */
    }

    /* 2. Reposition Zoom Indicator for Mobile */
    .zoom-indicator-inline {
        position: relative; /* Remove absolute 'right: -70px' from desktop */
        right: auto;
        bottom: auto;
        margin-top: 10px; /* Space below scale bar */
        display: block;
        text-align: center;
    }

    #zoomIndicator {
        /* EXACT DESKTOP STYLE */
        color: #ffffff; 
        font-family: "GothamSS", sans-serif; 
        font-weight: 900;
        font-size: 16px; 
        /* Heavy multi-directional shadow for maximum clarity */
        text-shadow: 2px 0 0 #000, -2px 0 0 #000, 0 2px 0 #000, 0 -2px 0 #000;
        display: block; 
        line-height: 1; 
        text-align: right;
    }

    .live-hud {
        /* Dock to bottom left */
        top: auto !important;
        left: 10px !important;
        bottom: 60px !important; /* Above the control panel */
        border-left: 3px solid #ffc107;
        background: rgba(0,0,0,0.95);
    }

    /* Increase the invisible touch area around the slider */
    .zoom-slider-track {
        width: 32px !important; /* Visual is 24px, but we expand for touch */
        border: 4px solid transparent; /* Acts as a padding-buffer */
        background-clip: padding-box;
        touch-action: none;
    }

    /* Make the handle taller so it's easier to grab */
    .zoom-slider-handle {
        width: 30px !important;
        height: 24px !important;
        border-radius: 4px !important;
    }

    /* Ensure the fill is visible inside the wide track */
    .zoom-slider-fill {
        width: 100% !important;
    }
}

/* --- TACTICAL INDICATOR TOOLTIPS --- */

[data-tooltip] {
  position: relative;
}

/* Tooltip Box Styling */
[data-tooltip]::before {
  content: attr(data-tooltip);
  position: absolute;
  right: calc(100% + 12px); /* Spacing to the left of buttons */
  top: 50%;
  transform: translateY(-50%) scale(0.9);
  
  /* Tactical Aesthetics matching GothamSS font */
  background-color: rgba(29, 31, 39, 0.95);
  color: #ffc107; 
  font-family: 'GothamSS', sans-serif;
  font-weight: 900;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 6px 12px;
  border-radius: 4px;
  border: 1px solid rgba(255, 193, 7, 0.4);
  white-space: nowrap;
  pointer-events: none;
  
  opacity: 0;
  transition: opacity 0.1s ease-out, transform 0.1s ease-out;
}

/* Small Indicator Arrow */
[data-tooltip]::after {
  content: '';
  position: absolute;
  right: calc(100% + 6px);
  top: 50%;
  transform: translateY(-50%);
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-left: 6px solid rgba(255, 193, 7, 0.4);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.1s ease-out;
}

/* Desktop Hover Interaction */
@media (hover: hover) {
  [data-tooltip]:hover::before {
    opacity: 1;
    transform: translateY(-50%) scale(1);
  }
  [data-tooltip]:hover::after {
    opacity: 1;
  }
}

/* Ensure arrow is fully opaque on hover */
@media (hover: hover) {
  [data-tooltip]:hover::after {
    opacity: 1 !important; /* Forces full visibility */
  }
}

/* Strictly hide tooltips on mobile to prevent UI clutter */
@media (max-width: 768px) {
  [data-tooltip]::before,
  [data-tooltip]::after {
    display: none !important;
  }
}

/* Hub specific content size */
.projects-hub-content {
  max-width: 500px !important;
  height: auto !important;
}

.projects-list {
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* THE ALIGNMENT FIX: Ensure buttons in modal use same flex logic */
.projects-list .footer-btn {
  display: flex;
  align-items: center;      /* Vertically centers icon/emoji and text */
  justify-content: flex-start; /* Aligns to left side */
  text-align: left;
  margin-bottom: 0;         /* Use gap from parent container instead */
}

/* Ensure images and emojis share exact same width for text alignment */
.projects-list .footer-project-icon, 
.projects-list .icon {
  width: 24px;              /* Consistent width for all icons */
  height: 24px;
  margin-right: 15px;       /* Consistent spacing to text */
  flex-shrink: 0;
  object-fit: contain;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* GitHub specific left border color */
.github-btn {
  border-left-color: #ffffff !important;
}

/* Increase main title size for all devices */
.main-title {
  font-size: 36px !important;
}

/* Smaller title for projects modal */
#projectsModal .main-title {
  font-size: 24px !important;
}

/* Increase main title size on mobile */
@media (max-width: 768px) {
  .main-title {
    font-size: 24px !important;
  }
  
  #projectsModal .main-title {
    font-size: 20px !important;
  }
}

/* --- Mobile Fire Button (Centered & Lower) --- */
.mobile-fire-btn {
  position: absolute;
  bottom: 120px; 
  left: 50%;
  transform: translateX(-50%);
  right: auto;
  
  background-color: rgba(220, 53, 69, 0.95);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-left: 4px solid #fff;
  color: white;
  
  font-family: 'GothamSS', sans-serif;
  font-weight: 900;
  font-size: 16px;
  padding: 12px 30px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 1px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.6);
  
  cursor: pointer;
  z-index: 500;
  pointer-events: auto;
  white-space: nowrap;
  
  display: flex;
  align-items: center;
  justify-content: center;
  
  /* Smooth return to normal position */
  transition: transform 0.1s ease, box-shadow 0.1s ease, background-color 0.1s;
}

/* THE FIX: Apply movement on :active AND .pressed class */
.mobile-fire-btn:active,
.mobile-fire-btn.pressed {
  /* 1. Maintain horizontal center (-50%) 
     2. Push DOWN (4px)
     3. Shrink slightly (0.95)
  */
  transform: translateX(-50%) translateY(4px) scale(0.95) !important;
  
  /* Reduce shadow to look "flat" against screen */
  box-shadow: 0 1px 5px rgba(0,0,0,0.4) !important; 
  
  /* Visual Feedback Colors */
  background-color: #ffc107 !important;
  color: black !important;
  border-color: transparent !important;
}

/* --- Ring Container (Scales via JS) --- */
.ring-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  /* Size is set by JS */
  pointer-events: none;
  z-index: 199;
}

/* --- Shared Ring Styles --- */
.m-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  box-sizing: border-box;
}

/* 1. Dispersion Circle (20m Radius / 100% Size) */
.m-ring.dispersion {
  width: 100%;
  height: 100%;
  
  /* CHANGED: Thinner line (1px) looks closer to SVG on high-DPI mobile screens */
  /* CHANGED: Slightly lower opacity (0.7) to match the "ghostly" look of the map marker */
  border: 2px dashed rgba(255, 255, 255, 0.7); 
  
  /* Keep background faint */
  background-color: rgba(255, 0, 0, 0.1); 
  
  /* CHANGED: Remove heavy outer shadow, keep slight inner glow for definition */
  box-shadow: inset 0 0 5px rgba(255, 0, 0, 0.1); 
}

/* 2. Deadzone Circle (10m Radius / 50% Size) */
.m-ring.deadzone {
  width: 50%;   /* 10m is half of 20m */
  height: 50%;
  border: 1px solid rgba(255, 255, 255, 0.5); /* Faint solid line */
  background-color: rgba(255, 0, 0, 0.15);    /* Slightly darker red */
}

/* 3. Blast Circle (5m Radius / 25% Size) */
.m-ring.blast {
  width: 25%;   /* 5m is quarter of 20m */
  height: 25%;
  background-color: rgba(255, 0, 0, 0.5); /* Dark red center */
  border: 1px solid rgba(255, 255, 255, 0.6); /* Solid white outline */
  box-shadow: 0 0 4px rgba(0,0,0,0.8);
}

/* --- Splash Damage Ring (High Visibility & Circular) --- */
.splash-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  
  /* Initial size (overwritten by JS) */
  width: 0;
  height: 0;
  
  /* THE FIX: Force it to be a circle */
  border-radius: 50% !important; 

  /* Visuals */
  border: 2px dashed rgba(255, 255, 255, 0.9); 
  background-color: rgba(255, 0, 0, 0.15); 
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(255, 0, 0, 0.2);
  
  pointer-events: none;
  z-index: 199;
  
  transition: width 0.1s linear, height 0.1s linear;
}

/* Inner Kill-Zone Dot (5m) */
.splash-ring::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 25%;
  height: 25%;
  background-color: rgba(255, 0, 0, 0.6); 
  border: 1px solid rgba(255, 255, 255, 0.8); 
  border-radius: 50%; /* Ensure this is also circular */
  box-shadow: 0 0 4px rgba(0,0,0,0.8);
}

/* --- Mobile HUD Positioning (Layering Fix) --- */
@media (max-width: 768px) {
  .live-hud {
    /* Reset fixed positions */
    bottom: auto !important;
    right: auto !important;
    
    /* Position anchor at exact screen center */
    top: 50% !important;
    left: 50% !important;
    
    /* Offset: Top-Right Quadrant */
    transform: translate(25px, calc(-100% - 10px));
    
    pointer-events: none;
    background: rgba(15, 15, 15, 0.90); /* Slightly more opaque background */
    border-left: 3px solid #ffc107;
    padding: 6px 10px;
    border-radius: 4px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.8); /* Stronger shadow for readability */
    
    /* LAYER FIX: Set higher than crosshair (200) so it sits ON TOP */
    z-index: 300 !important; 
    min-width: auto;
  }
  
  .live-hud .hud-label { font-size: 9px; }
  .live-hud .hud-value { font-size: 12px; }
}

/* Utility to hide them by default */
.hidden { display: none !important; }

/* Desktop: Always hide these elements */
@media (min-width: 769px) {
  .mobile-crosshair, .mobile-fire-btn {
    display: none !important;
  }
}

/* --- MOBILE SPECIFIC CLOSE BUTTON FIX --- */
@media (max-width: 768px) {
  .close-btn {
    /* 1. Force the position you requested */
    position: absolute !important;
    right: 5px !important;
    top: 5px !important;
    
    /* 2. Reset desktop transforms so it doesn't float away */
    transform: none !important;
    
    /* 3. Fix the "X" alignment inside the box (Crucial for Firefox Mobile) */
    display: flex !important;
    align-items: center;
    justify-content: center;
    
    /* 4. Ensure it has a clickable size without padding issues */
    width: 44px;
    height: 44px;
    padding: 0 !important;
    margin: 0 !important;
  }
}

/* --- INLINE STYLE REPLACEMENTS --- */
.map-arrow {
  font-size: 18px;
  margin-left: 10px;
}

.watermark-bullet {
  color: #ffc107;
  margin: 0 3px;
}

/* --- Desktop Cursor Follower --- */
#desktopCursorRings {
  position: fixed; /* Follows the viewport/mouse exactly */
  top: 0;
  left: 0;
  /* Keep the translation to center the rings exactly on the cursor tip */
  transform: translate(-50%, -50%);
  /* Ensure it sits above markers but below the control panel */
  z-index: 90; 
  pointer-events: none;
}

/* Hide it on mobile so we don't have double rings */
@media (max-width: 768px) {
  #desktopCursorRings {
    display: none !important;
  }
}

/* --- HUD CROSSHAIR (Center +) --- */
.hud-crosshair {
  position: absolute;
  top: 50%;
  left: 50%;
  /* Center exactly on the point */
  transform: translate(-50%, -50%);
  width: 14px;
  height: 14px;
  pointer-events: none;
  /* Ensure it sits on top of the Blast/Red circle (z-index 30) */
  z-index: 40; 
}

#mapStage {
    transition: opacity 0.2s ease-in-out;
}

/* The vertical and horizontal lines */
.hud-crosshair::before,
.hud-crosshair::after {
  content: '';
  position: absolute;
  background-color: #ffc107; /* Tactical Yellow */
  box-shadow: 0 0 2px rgba(0, 0, 0, 0.8); /* Shadow for contrast */
}

/* Vertical Line */
.hud-crosshair::before {
  top: 0;
  left: 50%;
  width: 2px;
  height: 100%;
  transform: translateX(-50%);
}

/* Horizontal Line */
.hud-crosshair::after {
  top: 50%;
  left: 0;
  width: 100%;
  height: 2px;
  transform: translateY(-50%);
}

/* Ensure the Manual Calculator Modal doesn't have dead space */
#calcModal .modal-content {
    height: auto !important;
    min-height: unset !important;
    max-height: 90vh;
    align-self: center; /* Centers vertically if it's short */
}

/* ==========================================
   MOBILE MAP MENU FIX (Absolute Centering)
   ========================================== */
@media (max-width: 768px) {
  
  /* 1. MAP MENU HEIGHT */
  .modal-content {
      height: 92vh !important; 
      max-height: none !important;
      margin: 0 !important;
      width: 95% !important;
      display: flex;
      flex-direction: column;
  }

  /* 2. FOOTER LAYOUT */
  .modal-footer {
      display: flex !important;
      flex-direction: row !important;
      align-items: stretch !important;
      gap: 10px !important;
      padding: 12px 10px !important;
      flex-shrink: 0 !important;
  }

  /* --- 3. CALCULATOR BUTTON (Square) --- */
  .footer-btn:first-child {
      position: relative !important; /* Anchor for absolute centering */
      flex: 0 0 54px !important; 
      width: 54px !important;
      height: 54px !important; 
      
      /* Kill all padding/margins that could push the icon */
      padding: 0 !important;
      margin: 0 !important;
      
      font-size: 0 !important; /* Hide text */
  }

  /* NUCLEAR OPTION: Absolute Centering Icon */
  .footer-btn:first-child .icon {
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important; /* Pin center to center */
      
      width: 24px !important;
      height: 24px !important;
      margin: 0 !important;
      padding: 0 !important;
      display: block !important;
  }

  /* --- 4. PROJECTS BUTTON (Wide) --- */
  .footer-btn:last-child {
      flex: 1 !important; 
      height: 54px !important;
      
      display: flex !important;
      align-items: center !important;
      justify-content: center !important; 
      
      font-size: 11px !important;
      padding: 0 10px !important;
      white-space: nowrap !important;
      margin: 0 !important;
  }
  
  /* Rocket Icon Alignment */
  .footer-btn:last-child .icon {
      font-size: 16px !important;
      margin-right: 10px !important; 
      display: block !important;
      flex-shrink: 0 !important;
      position: static !important; /* Default behavior for this one */
      transform: none !important;
  }
}

/* ==========================================
   MOBILE UI FIXES (Menu & Projects)
   ========================================== */
@media (max-width: 768px) {
  
  /* --- GLOBAL MODAL FIXES --- */
  .modal-content {
      height: 92vh !important; 
      max-height: none !important;
      margin: 0 !important;
      width: 95% !important;
      display: flex;
      flex-direction: column;
  }

  /* ----------------------------------------------------
     1. MAIN MENU FOOTER (The one with Calculator & Rocket)
     ---------------------------------------------------- */
  
  /* Container Layout */
  .modal-footer {
      display: flex !important;
      flex-direction: row !important;
      align-items: stretch !important;
      gap: 10px !important;
      padding: 12px 10px !important;
      flex-shrink: 0 !important;
  }

  /* CALC BUTTON (Square SVG) - Scoped to .modal-footer */
  .modal-footer .footer-btn:first-child {
      position: relative !important;
      flex: 0 0 54px !important; 
      width: 54px !important;
      height: 54px !important; 
      padding: 0 !important;
      margin: 0 !important;
      font-size: 0 !important; /* Hide Text */
  }

  /* CALC ICON (Absolute Center) */
  .modal-footer .footer-btn:first-child .icon {
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      
      width: 24px !important;
      height: 24px !important;
      margin: 0 !important;
      padding: 0 !important;
      display: block !important;
  }

  /* PROJECTS BUTTON (Wide) - Scoped to .modal-footer */
  .modal-footer .footer-btn:last-child {
      flex: 1 !important; 
      height: 54px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important; 
      font-size: 11px !important;
      padding: 0 10px !important;
      white-space: nowrap !important;
      margin: 0 !important;
  }
  
  .modal-footer .footer-btn:last-child .icon {
      font-size: 16px !important;
      margin-right: 10px !important; 
      display: block !important;
      flex-shrink: 0 !important;
      position: static !important;
      transform: none !important;
  }

  /* ----------------------------------------------------
     2. PROJECTS MODAL (The list of other apps)
     ---------------------------------------------------- */
     
  .projects-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 20px 15px;
      width: 100%;
  }

  /* RESET BUTTONS for Projects List */
  .projects-list .footer-btn {
      /* Force full width bars */
      flex: 0 0 auto !important;
      width: 100% !important;
      height: auto !important;
      min-height: 54px !important;
      
      /* Normal Text Display */
      font-size: 13px !important; 
      
      /* Alignment */
      display: flex !important;
      flex-direction: row !important;
      align-items: center !important;
      justify-content: flex-start !important; /* Align left */
      
      padding: 12px 20px !important;
      margin: 0 !important;
  }

  /* RESET ICONS inside Projects List */
  .projects-list .footer-project-icon, 
  .projects-list .icon {
      width: 24px !important;
      height: 24px !important;
      margin-right: 15px !important;
      margin-left: 0 !important;
      display: block !important;
      object-fit: contain !important;
      
      /* Ensure they don't inherit the absolute positioning from above */
      position: static !important;
      transform: none !important;
      top: auto !important;
      left: auto !important;
  }
}

/* ==========================================
   DESKTOP ICON SYNC (1:1 SIZE)
   ========================================== */
@media (min-width: 769px) {
    /* 1. Force both icons to be EXACT same size */
    .modal-footer .footer-btn .icon {
        width: 26px !important; 
        height: 26px !important;
        margin-right: 12px !important;
        
        /* Remove ALL previous scaling and centering */
        position: static !important;
        transform: none !important;
        display: inline-block !important;
        vertical-align: middle !important;
        
        /* Ensure stroke weight is consistent */
        stroke-width: 2.2 !important;
    }

    /* 2. Specific fix for More Projects to ensure no extra scale is hiding */
    #btnOtherProjects .icon {
        width: 26px !important;
        height: 26px !important;
        transform: none !important; 
    }

    /* 3. Adjust button height to fit icons cleanly */
    .modal-footer .footer-btn {
        height: 54px !important;
        padding: 0 20px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }
}

/* ==========================================
   MOBILE UI FIX: INCREASE PROJECTS FONT
   ========================================== */
@media (max-width: 768px) {
    /* Target the text inside the "More Projects" button in the footer */
    .modal-footer .footer-btn:last-child {
        font-size: 14px !important; /* Increased from 11px to 14px */
        font-weight: 900 !important; /* Thickest weight for readability */
        letter-spacing: 1px !important;
        
        /* Ensure it remains centered even with larger text */
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    /* Keep the "tactical Stack" icon aligned with the larger text */
    .modal-footer .footer-btn:last-child .icon {
        margin-right: 12px !important;
        width: 22px !important; /* Balanced size for the larger text */
        height: 22px !important;
    }
}

/* ==========================================
   DESKTOP HOVER FIX: MORE PROJECTS
   ========================================== */
@media (hover: hover) and (min-width: 769px) {
    /* Target button AND icon inside when hovering */
    .modal-footer #btnOtherProjects:hover {
        background: rgba(255, 193, 7, 0.1) !important; /* Subtle yellow glow BG */
        border-color: #ffc107 !important;            /* Bright yellow border */
        color: #ffc107 !important;                   /* Yellow text */
        box-shadow: 0 0 15px rgba(255, 193, 7, 0.1) !important;
    }

    /* Ensure the icon specifically turns yellow too */
    .modal-footer #btnOtherProjects:hover .icon {
        stroke: #ffc107 !important;
        filter: none !important; /* Removes any grayscale if present */
    }
}

/* --- MOBILE SPECIFIC: ENSURE NO STICKY HOVER --- */
@media (max-width: 768px) {
    /* Reset any potential lingering hover states on mobile */
    .modal-footer #btnOtherProjects:hover {
        background: rgba(255, 255, 255, 0.05) !important;
        border-color: rgba(255, 255, 255, 0.1) !important;
        color: rgba(255, 255, 255, 0.8) !important;
        box-shadow: none !important;
    }
    
    /* Ensure icon stays muted grey on mobile hover */
    .modal-footer #btnOtherProjects:hover .icon {
        stroke: currentColor !important;
        opacity: 0.8 !important;
    }
}

/* ==========================================
   MOBILE HUB: REMOVE EMPTY SPACE
   ========================================== */
@media (max-width: 768px) {
    /* Target Projects Hub specifically to remove forced height */
    #projectsModal .modal-content {
        height: auto !important;      /* Shrink to fit the list */
        min-height: unset !important;
        max-height: 80vh !important;  /* Safety limit */
        margin: auto !important;      /* Centers it vertically in the blur */
        align-self: center !important;
    }

    /* Adjust the list padding for a tighter fit */
    #projectsModal .projects-list {
        padding: 15px !important;
        gap: 10px !important;
    }
}

/* --- PROJECTS HUB EXTERNAL LINK ICONS --- */

.projects-list .footer-btn {
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important;
    padding-left: 20px !important;
    /* Reduced right padding to let the icon get closer to the edge */
    padding-right: 15px !important; 
    width: 100% !important;
}

/* This forces the text to take up all available space, pushing the icon to the end */
.projects-list .footer-btn span {
    flex-grow: 1 !important;
    text-align: left !important;
}

.external-link-icon {
    width: 14px !important;
    height: 14px !important;
    opacity: 0.4;
    transition: all 0.2s ease;
    
    /* Ensure it doesn't shrink and stays at the very end */
    flex-shrink: 0 !important;
    margin-left: 10px !important; 
}

/* Hover highlight for the whole button */
.projects-list .footer-btn:hover {
    border-color: #ffc107 !important;
    color: #ffc107 !important;
}

.projects-list .footer-btn:hover .external-link-icon {
    opacity: 1;
    color: #ffc107;
    /* Subtle pop effect on hover */
    transform: translateX(2px); 
}

/* Mobile Tweak: Slightly larger icon for touch screens */
@media (max-width: 768px) {
    .external-link-icon {
        width: 16px !important;
        height: 16px !important;
    }
}

/* ==========================================
   TEMPORARY: REMOVE HUD CROSSHAIRS
   ========================================== */

/* Completely hide the crosshair element and its pseudo-elements (lines) */
.hud-crosshair, 
.hud-crosshair::before, 
.hud-crosshair::after {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    width: 0 !important;
    height: 0 !important;
}

/* Ensure the ring containers stay centered without the crosshair influencing layout */
.ring-container {
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ==========================================
   FINAL FIX: MOBILE STICKY HOVER RESET (WHITE ICONS)
   ========================================== */
@media (hover: none) {
  /* 1. BACKGROUND: Force Grey (No Yellow) on Focus/Hover */
  .footer-btn:hover,
  .footer-btn:focus,
  .footer-btn:focus-visible,
  .projects-list .footer-btn:hover, 
  .projects-list .footer-btn:focus {
    background: rgba(255, 255, 255, 0.05) !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
    color: rgba(255, 255, 255, 0.8) !important;
    box-shadow: none !important;
    outline: none !important;
  }

  /* 2. ICONS: Force them BRIGHT WHITE (opacity 1), not Grey */
  .footer-btn:hover .icon,
  .footer-btn:focus .icon,
  .footer-btn:focus-visible .icon,
  .projects-list .footer-btn:hover .external-link-icon,
  .projects-list .footer-btn:focus .external-link-icon {
    stroke: #ffffff !important; /* Force Bright White */
    fill: none !important;
    opacity: 1 !important;      /* CHANGED: 0.4 -> 1 (Fully Visible) */
    transform: none !important;
  }

  /* 2b. DOTS: Ensure dots inside calculator icon are also white */
  .footer-btn:hover .icon circle,
  .footer-btn:focus .icon circle {
    fill: #ffffff !important;
    stroke: none !important;
  }

  /* 3. ACTIVE: The ONLY time it should be yellow (While finger is down) */
  .footer-btn:active,
  .projects-list .footer-btn:active {
    background: rgba(255, 193, 7, 0.2) !important;
    border-color: #ffc107 !important;
    color: #ffc107 !important;
    transition: none !important;
  }
  
  .footer-btn:active .icon,
  .projects-list .footer-btn:active .external-link-icon {
      opacity: 1 !important;
      stroke: #ffc107 !important; /* Yellow when actually pressing */
  }
  
  .footer-btn:active .icon circle {
      fill: #ffc107 !important;
  }
}